<div class="bordered-block">
    <h2>按月統計</h2>
    <form class="form-horizontal" id="monthly_form" data-render-to="monthly_chart">
        <div class="form-group form-group-lg">
            <label for="start_month" class="col-sm-2 control-label">開始月份</label>
            <div class="col-sm-10">
                <input class="month-picker form-control" name="start_month" data-date-format="yyyy-mm" value="<?= htmlspecialchars($start_month) ?>" autocomplete="off">
            </div>
        </div>
        <div class="form-group form-group-lg">
            <label for="end_month" class="col-sm-2 control-label">結束月份</label>
            <div class="col-sm-10">
                <input class="month-picker form-control" name="end_month" data-date-format="yyyy-mm" value="<?= htmlspecialchars($end_month) ?>" autocomplete="off">
            </div>
        </div>
        <div class="form-group form-group-lg">
            <div class="col-sm-offset-2 col-sm-10">
                <input type="hidden" name="topic" value="<?= htmlspecialchars($topic) ?>" />
                <input type="hidden" name="period" value="monthly" />
                <button type="submit" class="btn btn-default">送出</button>
            </div>
        </div>
    </form>
    <div id="monthly_chart"></div>
</div>
<div class="bordered-block">
    <h2>按日統計</h2>
    <form class="form-horizontal" id="monthly_form" data-render-to="daily_chart">
        <div class="form-group form-group-lg">
            <label for="start_month" class="col-sm-2 control-label">開始日期</label>
            <div class="col-sm-10">
                <input class="date-picker form-control" name="start_date" data-date-format="yyyy-mm-dd" value="<?= htmlspecialchars($start_date) ?>" autocomplete="off">
            </div>
        </div>
        <div class="form-group form-group-lg">
            <label for="end_month" class="col-sm-2 control-label">結束日期</label>
            <div class="col-sm-10">
                <input class="date-picker form-control" name="end_date" data-date-format="yyyy-mm-dd" value="<?= htmlspecialchars($end_date) ?>" autocomplete="off">
            </div>
        </div>
        <div class="form-group form-group-lg">
            <div class="col-sm-offset-2 col-sm-10">
                <input type="hidden" name="topic" value="<?= htmlspecialchars($topic) ?>" />
                <input type="hidden" name="period" value="daily" />
                <button type="submit" class="btn btn-default">送出</button>
            </div>
        </div>
    </form>
    <div id="daily_chart"></div>
</div>

<script>
$('.month-picker').datepicker({
    format: 'yyyy-mm',
    viewMode: "months",
    minViewMode: "months",
    autoclose: true,
    todayHighlight: true
});
$('.date-picker').datepicker({
    format: 'yyyy-mm-dd',
    autoclose: true,
    todayHighlight: true
});

$('#monthly_form, #daily_form').submit(function(e) {
    e.preventDefault();
    $form = $(this);
    var data = $(this).serializeArray();
    var renderTo = $form.data('render-to');
    var $renderTo = $('#' + renderTo);
    $renderTo.empty()
    var $loader = $('<div>').addClass('loader').appendTo($renderTo).css({
        'margin': 'auto'
    });
    $.get('/ajax_get_statistics_result.php', data, function(rtn) {
        $loader.remove();
        if (rtn.error) {
            alert(rtn.msg);
            return;
        }
        renderByAjaxRtn(renderTo, rtn);
    }, 'json');
});

$(function(){
    $('#monthly_form, #daily_form').submit();
});
</script>
