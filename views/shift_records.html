<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <title><?= htmlspecialchars($store->nickname) ?> 關帳紀錄</title>
    <?php include(VIEWS_DIR . "/include/static_common.html"); ?>
    <?php include(VIEWS_DIR . "/include/bootstrap_datepicker.html"); ?>
</head>

<body>
<?php include(VIEWS_DIR . "/include/manage_nav.html"); ?>

<div class="container">
    <div>
        <h1><?= htmlspecialchars($store->nickname) ?> 關帳紀錄</h1>
    </div>

    <div class="bordered-block">
        <form class="form-horizontal" id="stat-form" data-render-to="stat-chart">
            <div class="form-group form-group-lg">
                <label for="start_date" class="col-sm-2 control-label">開始日期</label>
                <div class="col-sm-10">
                    <input class="datepicker form-control" name="start_date" data-date-format="yyyy-mm" value="<?= htmlspecialchars($start_date) ?>" autocomplete="off">
                </div>
            </div>
            <div class="form-group form-group-lg">
                <label for="end_date" class="col-sm-2 control-label">結束日期</label>
                <div class="col-sm-10">
                    <input class="datepicker form-control" name="end_date" data-date-format="yyyy-mm" value="<?= htmlspecialchars($end_date) ?>" autocomplete="off">
                </div>
            </div>
            <div class="form-group form-group-lg">
                <div class="col-sm-offset-2 col-sm-10">
                    <input type="hidden" name="topic" value="<?= htmlspecialchars($topic) ?>" />
                    <button type="submit" class="btn btn-default">送出</button>
                </div>
            </div>
        </form>
    </div>
    <div class="bordered-block">
        <table class="table table-striped">
            <thead>
                <tr>
                    <td>營業日</td>
                    <td>營業額</td>
                    <td>錢櫃初始金額</td>
                    <td>錢櫃結餘總額</td>
                    <td>臨時支出</td>
                    <td>臨時收入</td>
                    <td>錢櫃應有現金</td>
                    <td>現金短溢</td>
                    <td>結餘處理</td>
                    <td>結餘處理人</td>
                    <td>錢櫃留存現金</td>
                    <td>關帳時間</td>
                </tr>
            </thead>
            <tbody>
                <?php foreach ($datasets as $dataset) { ?>
                <tr>
                    <td><?= htmlspecialchars($dataset['business_date']) ?></td>
                    <td><?= $currency_symbol . floatval($dataset['sales']) ?></td>
                    <td><?= $currency_symbol . floatval($dataset['open_amount']) ?></td>
                    <td><?= $currency_symbol . floatval($dataset['close_amount']) ?></td>
                    <td><?= $currency_symbol . floatval($dataset['paid_out']) ?></td>
                    <td><?= $currency_symbol . floatval($dataset['paid_in']) ?></td>
                    <td><?= $currency_symbol . floatval($dataset['expected_amount']) ?></td>
                    <td><?= sprintf('%s%s%s', $dataset['difference'] > 0 ? '+' : '-', $currency_symbol, abs(floatval($dataset['difference']))) ?></td>
                    <td><?= htmlspecialchars($dataset['adjustment_type_text']) ?> <?= $currency_symbol . floatval($dataset['adjustment_amount']) ?></td>
                    <td><?= htmlspecialchars($dataset['adjustment_by']) ?></td>
                    <td><?= $currency_symbol . floatval($dataset['float']) ?></td>
                    <td><?= date('Y-m-d H:i:s', $dataset['created_at']) ?></td>
                </tr>
                <?php } ?>
            </tbody>
        </table>
    </div>
</div>

<script>
$('.datepicker').datepicker({
    format: 'yyyy-mm-dd',
    autoclose: true,
    todayHighlight: true,
    zIndexOffset: 2000
});
</script>
