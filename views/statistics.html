<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <title><?= htmlspecialchars($store->nickname) ?> 統計數據</title>
    <?php include(VIEWS_DIR . "/include/static_common.html"); ?>
    <script type="text/javascript" src="static/highcharts.src.js"></script>
</head>

<body>
<?php include(VIEWS_DIR . "/include/manage_nav.html"); ?>

<div class="container">
    <div>
        <h1><?= htmlspecialchars($store->nickname) ?> 統計數據</h1>
    </div>

    <div id="month_chart" style="min-width: 310px; height: 400px; margin: 0 auto 30px auto"></div>
    <div id="date_chart" style="min-width: 310px; height: 400px; margin: 0 auto 30px auto"></div>
</div>

<script>
var chart;
var highchart = function(title, renderTo, categories, turnover, discount){
    var char_options = {
        chart: {
            renderTo: renderTo,
            type: 'line',
            marginRight: 130,
            marginBottom: 25
        },
        title: {
            text: title,
            x: -20 //center
        },
        subtitle: {
            text: '',
            x: -20
        },
        xAxis: {
            categories: categories
        },
        yAxis: {
            title: {
                text: '金額'
            },
            plotlines: [{
            value: 0,
            width: 1,
            color: '#808080'
            }]
        },
        plotOptions: {
            line: {
                dataLabels: {
                    enabled: true
                },
                enableMouseTracking: false
            }
        },
        tooltip: {
            pointformat: '{series.name}: <b>{point.y}</b><br/>',
            valuesuffix: ' 元',
            shared: true
        },
        legend: {
            layout: 'vertical',
            align: 'right',
            verticalalign: 'middle',
            borderwidth: 0
        },
        series: [{
            name: '總營收'
        }, {
            name: '折扣'
        }]
    };

    char_options.series[0].data = $.parseJSON(turnover);
    char_options.series[1].data = $.parseJSON(discount);

    chart = new Highcharts.Chart(char_options);
};

highchart(
    '月營收狀況',
    'month_chart',
    [<?= implode(',', array_map('json_encode', $month_names)) ?>],
    "[<?= implode(',', array_map('json_encode', $month_turnovers)) ?>]",
    "[<?= implode(',', array_map('json_encode', $month_discounts)) ?>]"
);

highchart(
    '30天內營收狀況',
    'date_chart',
    [<?= implode(',', array_map('json_encode', $date_names)) ?>],
    "[<?= implode(',', array_map('json_encode', $date_turnovers)) ?>]",
    "[<?= implode(',', array_map('json_encode', $date_discounts)) ?>]"
);
</script>
</body>
</html>
